<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <!-- charset must remain utf-8 to be handled properly by Processing -->
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <title>CellLogMonitor : Built with Processing</title>

    <style type="text/css">
      /* <![CDATA[ */
	
	body {
  	  margin: 60px 0px 0px 55px;
	  font-family: verdana, geneva, arial, helvetica, sans-serif; 
	  font-size: 11px; 
	  background-color: #ddddcc; 
	  text-decoration: none; 
	  font-weight: normal; 
	  line-height: normal; 
	}
		 
	a          { color: #3399cc; }
	a:link     { color: #3399cc; text-decoration: underline; }
	a:visited  { color: #3399cc; text-decoration: underline; }
	a:active   { color: #3399cc; text-decoration: underline; }
	a:hover    { color: #3399cc; text-decoration: underline; }

      /* ]]> */
    </style>    
  </head>

  <body>
    <div id="content">
      <div id="CellLogMonitor_container">

	<!-- This version plays nicer with older browsers, 
	     but requires JavaScript to be enabled. 
	     http://java.sun.com/javase/6/docs/technotes/guides/jweb/deployment_advice.html -->
	<script type="text/javascript"
		src="http://www.java.com/js/deployJava.js"></script>
	<script type="text/javascript">
	  /* <![CDATA[ */

	  var attributes = { 
            code: 'CellLogMonitor.class',
            archive: 'CellLogMonitor.jar,RXTXcomm.jar,serial.jar,net.jar,core.jar',
            width: 400, 
            height: 400,
            image: 'loading.gif'
          };
          var parameters = { };
          var version = '1.5';
          deployJava.runApplet(attributes, parameters, version);

          /* ]]> */
        </script>
        
	<noscript> <div>
	  <!--[if !IE]> -->
	  <object classid="java:CellLogMonitor.class" 
            	  type="application/x-java-applet"
            	  archive="CellLogMonitor.jar,RXTXcomm.jar,serial.jar,net.jar,core.jar"
            	  width="400" height="400"
            	  standby="Loading Processing software..." >
            
	    <param name="archive" value="CellLogMonitor.jar,RXTXcomm.jar,serial.jar,net.jar,core.jar" />
	    
	    <param name="mayscript" value="true" />
	    <param name="scriptable" value="true" />
	    
	    <param name="image" value="loading.gif" />
	    <param name="boxmessage" value="Loading Processing software..." />
	    <param name="boxbgcolor" value="#FFFFFF" />
	    
	    <param name="test_string" value="outer" />
	  <!--<![endif]-->

	    <!-- For more instructions on deployment, 
		 or to update the CAB file listed here, see:
		 http://java.sun.com/javase/6/webnotes/family-clsid.html
		 http://java.sun.com/javase/6/webnotes/install/jre/autodownload.html -->
	    <object classid="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93"
		    codebase="http://java.sun.com/update/1.6.0/jinstall-6u20-windows-i586.cab"
		    width="400" height="400"
		    standby="Loading Processing software..."  >
	      
	      <param name="code" value="CellLogMonitor" />
	      <param name="archive" value="CellLogMonitor.jar,RXTXcomm.jar,serial.jar,net.jar,core.jar" />
	      
	      <param name="mayscript" value="true" />
	      <param name="scriptable" value="true" />
	      
	      <param name="image" value="loading.gif" />
	      <param name="boxmessage" value="Loading Processing software..." />
	      <param name="boxbgcolor" value="#FFFFFF" />
	      
	      <param name="test_string" value="inner" />
	      
	      <p>
		<strong>
		  This browser does not have a Java Plug-in.
		  <br />
		  <a href="http://www.java.com/getjava" title="Download Java Plug-in">
		    Get the latest Java Plug-in here.
		  </a>
		</strong>
	      </p>
	      
	    </object>
	    
	  <!--[if !IE]> -->
	  </object>
	  <!--<![endif]-->

	</div> </noscript>

      </div>
      
      <p>
	
 Simple Read
 
 Read data from the serial port and change the color of a rectangle
 when a switch connected to a Wiring or Arduino board is pressed and released.
 This example works with the Wiring / Arduino program that follows below.
/


import processing.serial.*;
import processing.net.*;

Serial myPort;  // Create object from Serial class
Server myServer;

int val;      // Data received from the serial port
int lf = 10;  // Linefeed

void setup() 
{
  size(400, 400);
  // I know that the first port in the serial list on my mac
  // is always my  FTDI adaptor, so I open Serial.list()[0].
  // On Windows machines, this generally opens COM1.
  // Open whatever port is the one you're using.
  String portName = Serial.list()[0];
  myPort = new Serial(this, portName, 9600);
  myPort.clear();
  background(255);             // Set background to white
  myServer = new Server(this, 7373); 

}

void draw()
{
  
  int i;
  int xadd;
  int w;
  PFont font;
  float max;
  float min;
  Date now = new Date();
  
  xadd = width / 10;
  w=20;

//  int sensors[] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
  fill(75);                 // set fill to light gray
  // The font must be located in the sketch's 
  // "data" directory to load successfully
  font = loadFont("ArialMT-12.vlw"); 
  textFont(font);

  if ( myPort.available() > 0) {  // If data is available,
    String inBuffer = myPort.readStringUntil(lf);   

    background(255);             // Set background to white
    //fill(204);                 // set fill to light gray
    
    if (inBuffer != null) {
        
        myServer.write(inBuffer); // output raw serial data for any clients
        
        float sensors[] = float(split(inBuffer, ';'));

        println(sensors[3]);
        println(sensors[4]);
        println(sensors[5]);
        println(sensors[6]);
        println(sensors[7]);
        println(sensors[8]);
        println(sensors[9]);
        println(sensors[10]);

        println(inBuffer);
        max = 0;
        min = 9999;
        
        for (i = 3; i<11; i++)
        {
          float y = map(sensors[i],0,5000,0,height);
          rect(xadd*i-xadd*3+xadd, height, w, -y);
          if (max < sensors[i])
            max = sensors[i];
          if (min > sensors[i])
            min = sensors[i];          
        }
        
        text("MIN",10,30);
        text("MAX",10,50);
        text("DELTA",10,70);

        text(min/1000 + " V",60,30);
        text(max/1000 + " V",60,50);
        text((max-min)/1000 + " mV", 60,70);

        text("now:" + now, 60,90);
        
    }
  }

}



/*

// Wiring / Arduino Code
// Code for sensing a switch status and writing the value to the serial port.

int switchPin = 4;                       // Switch connected to pin 4

void setup() {
  pinMode(switchPin, INPUT);             // Set pin 0 as an input
  Serial.begin(9600);                    // Start serial communication at 9600 bps
}

void loop() {
  if (digitalRead(switchPin) == HIGH) {  // If switch is ON,
    Serial.print(1, BYTE);               // send 1 to Processing
  } else {                               // If the switch is not ON,
    Serial.print(0, BYTE);               // send 0 to Processing
  }
  delay(100);                            // Wait 100 milliseconds
}



      </p>
      
      <p>
	Source code: <a href="CellLogMonitor.pde">CellLogMonitor</a> 
      </p>
      
      <p>
	Built with <a href="http://processing.org" title="Processing.org">Processing</a>
      </p>
    </div>
  </body>
</html>
